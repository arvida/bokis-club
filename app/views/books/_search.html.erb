<div data-controller="book-search"
     data-book-search-url-value="<%= search_books_path %>"
     data-book-search-club-id-value="<%= local_assigns[:club]&.id %>">

  <div class="relative mb-4">
    <input type="text"
           data-book-search-target="input"
           data-action="input->book-search#search"
           placeholder="<%= t("books.search.placeholder") %>"
           autofocus
           class="form-input">

    <div data-book-search-target="loading" class="hidden absolute right-4 top-1/2 -translate-y-1/2">
      <svg class="animate-spin h-5 w-5 text-ink-muted" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </div>
  </div>

  <turbo-frame id="book-search-results" data-book-search-target="results">
    <div class="py-8 text-center text-ink-muted">
      <p><%= t("books.search.enter_query") %></p>
    </div>
  </turbo-frame>

  <div data-book-search-target="selected" class="hidden border-t border-cream pt-4 mt-4">
    <div class="flex gap-4 items-start">
      <div data-book-search-target="selectedCover" class="w-20 flex-shrink-0"></div>
      <div class="flex-1">
        <h3 data-book-search-target="selectedTitle" class="font-display text-lg font-medium"></h3>
        <p data-book-search-target="selectedAuthors" class="text-ink-muted text-sm"></p>
      </div>
      <button type="button"
              data-action="book-search#clearSelection"
              class="text-ink-muted hover:text-ink transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
    <input type="hidden" name="google_books_id" data-book-search-target="hiddenId">
  </div>

  <div data-book-search-target="manualEntry" class="hidden border-t border-cream pt-4 mt-4">
    <h3 class="font-display text-lg font-medium mb-4"><%= t("books.manual_entry.title") %></h3>

    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-ink-muted mb-2"><%= t("books.manual_entry.fields.title") %> *</label>
        <input type="text" name="book[title]" required disabled
               data-book-search-target="manualInput"
               class="form-input">
      </div>

      <div>
        <label class="block text-sm font-medium text-ink-muted mb-2"><%= t("books.manual_entry.fields.authors") %></label>
        <input type="text" name="book[authors_string]" placeholder="<%= t("books.manual_entry.fields.authors_hint") %>" disabled
               data-book-search-target="manualInput"
               class="form-input">
      </div>

      <div>
        <label class="block text-sm font-medium text-ink-muted mb-2"><%= t("books.manual_entry.fields.description") %></label>
        <textarea name="book[description]" rows="3" disabled
                  data-book-search-target="manualInput"
                  class="form-input"></textarea>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-ink-muted mb-2"><%= t("books.manual_entry.fields.page_count") %></label>
          <input type="number" name="book[page_count]" min="1" disabled
                 data-book-search-target="manualInput"
                 class="form-input">
        </div>

        <div>
          <label class="block text-sm font-medium text-ink-muted mb-2"><%= t("books.manual_entry.fields.isbn") %></label>
          <input type="text" name="book[isbn]" disabled
                 data-book-search-target="manualInput"
                 class="form-input">
        </div>
      </div>
    </div>

    <div class="mt-4">
      <button type="button"
              data-action="book-search#hideManualEntry"
              class="text-sm text-ink-muted hover:text-ink transition-colors">
        <%= t("books.manual_entry.back_to_search") %>
      </button>
    </div>
  </div>
</div>
