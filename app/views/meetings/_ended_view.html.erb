<%# Ended Meeting Header %>
<div class="px-2 sm:px-6 pt-6 pb-4">
  <div class="mb-4">
    <%= render "shared/back_link", path: club_path(club) %>
  </div>

  <%# Ended badge %>
  <div class="flex items-center gap-2 mb-4">
    <span class="inline-flex items-center gap-1.5 px-3 py-1 bg-ink-muted/10 rounded-full">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-ink-muted" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
      </svg>
      <span class="text-xs font-medium tracking-widest text-ink-muted uppercase"><%= t("meetings.ended.indicator") %></span>
    </span>
  </div>

  <%# Title and book %>
  <div class="flex items-start gap-4 mb-6">
    <% if meeting.club_book&.book %>
      <%= link_to club_club_book_path(club, meeting.club_book), class: "flex-shrink-0 w-16 group" do %>
        <%= render "shared/book_cover", book: meeting.club_book.book, size: :medium,
            class: "w-full rounded shadow-lg group-active:scale-95 transition-transform" %>
      <% end %>
    <% end %>
    <div class="flex-1">
      <h1 class="font-display text-xl font-light text-ink mb-1"><%= meeting.title %></h1>
      <p class="text-sm text-ink-muted">
        <%= t("meetings.ended.ended_at", time: I18n.l(meeting.ended_at, format: "%H:%M")) if meeting.ended_at %>
      </p>
    </div>
  </div>
</div>

<%# Checked-in attendees summary %>
<% if meeting.checked_in_count > 0 %>
  <div class="px-2 sm:px-6 py-4 bg-paper-warm border-y border-cream">
    <div class="flex items-center gap-2 text-sm text-ink-muted">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-sage" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
      </svg>
      <span><%= t("meetings.ended.checked_in_count", count: meeting.checked_in_count) %></span>
    </div>
  </div>
<% end %>

<%# Discussion Guide Summary (read-only) %>
<% if meeting.discussion_guide&.items&.any? %>
  <div class="px-2 sm:px-6 py-6">
    <span class="inline-block text-xs font-medium tracking-widest text-vermillion uppercase mb-4">
      <%= t("meetings.discussion_guide.title") %>
    </span>
    <ul class="space-y-3">
      <% meeting.discussion_guide.items.each do |item| %>
        <li class="flex items-start gap-3">
          <span class="flex-shrink-0 mt-1 w-4 h-4 rounded border <%= item["checked"] ? 'bg-sage border-sage' : 'border-ink-muted/30' %>">
            <% if item["checked"] %>
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-white" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            <% end %>
          </span>
          <span class="text-ink <%= item["checked"] ? 'line-through text-ink-muted' : '' %>"><%= item["text"] %></span>
        </li>
      <% end %>
    </ul>
  </div>
<% end %>

<%# Comments Section %>
<div class="px-2 sm:px-6 py-6 border-t border-cream">
  <%= render "meetings/comments_section", meeting: meeting, club: club %>
</div>

<%# Admin actions - sticky bottom %>
<% if club.admin?(current_user) %>
  <div class="px-2 sm:px-6 py-4 border-t border-cream bg-paper sticky bottom-0">
    <%= button_to resume_club_meeting_path(club, meeting),
        method: :post,
        class: "w-full inline-flex items-center justify-center gap-2 px-4 py-3 bg-sage text-white text-sm font-medium rounded-xl active:scale-[0.98] transition-transform" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
      </svg>
      <%= t("meetings.ended.resume_meeting") %>
    <% end %>
  </div>
<% end %>
