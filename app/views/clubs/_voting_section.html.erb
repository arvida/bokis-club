<div class="bg-vermillion/5 rounded-lg p-6 mb-8 border border-vermillion/20">
  <div class="flex items-center justify-between mb-4">
    <span class="inline-block text-xs font-medium tracking-widest text-vermillion">
      <%= t("clubs.voting_section.department") %>
    </span>
    <span class="text-xs text-vermillion/70">
      <%= t("clubs.voting_section.books_count", count: voting_books.size) %>
    </span>
  </div>

  <h2 class="font-display text-xl font-light mb-4"><%= t("clubs.voting_section.title") %></h2>

  <% has_voted = user_vote.present? %>

  <% if has_voted %>
    <div class="bg-white/50 rounded-lg p-4 mb-4 flex items-center gap-3">
      <div class="w-8 h-8 rounded-full bg-sage/20 flex items-center justify-center flex-shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-sage" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
        </svg>
      </div>
      <div class="text-sm">
        <span class="text-ink-muted"><%= t("club_books.vote.your_vote") %></span>
        <span class="font-medium text-ink"><%= user_vote.club_book.book.title %></span>
      </div>
    </div>
  <% end %>

  <div class="space-y-3">
    <% voting_books.each do |club_book| %>
      <% is_voted = user_vote&.club_book_id == club_book.id %>
      <div class="flex items-center gap-3 p-3 rounded-lg <%= is_voted ? 'bg-sage/10 border border-sage/30' : 'bg-white/50' %>">
        <div class="w-12 flex-shrink-0">
          <%= render "shared/book_cover", book: club_book.book, class: "w-full shadow-sm rounded" %>
        </div>

        <div class="flex-1 min-w-0">
          <p class="font-medium text-sm truncate"><%= club_book.book.title %></p>
          <p class="text-xs text-ink-muted"><%= t("club_books.vote.votes", count: club_book.vote_count) %></p>
        </div>

        <div class="flex-shrink-0">
          <% if is_voted %>
            <span class="text-sage text-xs font-medium flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
              </svg>
            </span>
          <% elsif !has_voted %>
            <%= button_to t("club_books.vote.vote"),
                vote_club_club_books_path(club, club_book_id: club_book.id),
                method: :post,
                class: "px-3 py-1.5 bg-vermillion text-white text-xs font-medium rounded-lg hover:bg-vermillion-dark transition-colors" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <% if is_admin %>
    <div class="mt-4 pt-4 border-t border-vermillion/20">
      <%= button_to t("club_books.vote.end_voting"),
          end_voting_club_club_books_path(club),
          method: :post,
          form: { data: { turbo_confirm: t("club_books.vote.end_voting_confirm") } },
          class: "w-full px-4 py-2 border border-vermillion text-vermillion text-sm font-medium rounded-lg hover:bg-vermillion hover:text-white transition-colors" %>
    </div>
  <% end %>
</div>
