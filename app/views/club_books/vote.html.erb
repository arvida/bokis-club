<div class="max-w-2xl mx-auto px-2 sm:px-6 py-8">
  <div class="mb-4">
    <%= render "shared/back_link", path: club_club_books_path(@club) %>
  </div>

  <span class="inline-block text-xs font-medium tracking-widest text-vermillion mb-3">
    <%= t("club_books.vote.department") %>
  </span>

  <h1 class="font-display text-2xl font-light mb-8"><%= t("club_books.vote.title") %></h1>

  <% if @voting_books.empty? %>
    <div class="text-center py-12">
      <div class="w-16 h-16 mx-auto mb-6 rounded-full bg-cream flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-ink-muted" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
        </svg>
      </div>

      <p class="text-ink mb-2"><%= t("club_books.vote.no_voting") %></p>

      <% if @suggestions_count > 0 %>
        <p class="text-ink-muted text-sm mb-6">
          <%= t("club_books.vote.suggestions_waiting", count: @suggestions_count) %>
        </p>

        <% if @club.admin?(current_user) && @suggestions_count >= 2 %>
          <%= button_to t("club_books.index.start_voting"),
              start_voting_club_club_books_path(@club),
              method: :post,
              class: "inline-block px-6 py-3 bg-vermillion text-white font-medium rounded-lg hover:bg-vermillion-dark transition-colors mb-4" %>
          <br>
        <% end %>
      <% else %>
        <p class="text-ink-muted text-sm mb-6"><%= t("club_books.vote.no_suggestions") %></p>
      <% end %>

      <%= link_to t("club_books.vote.back_to_suggestions"),
          club_club_books_path(@club),
          class: "text-vermillion hover:text-vermillion-dark transition-colors" %>
    </div>
  <% else %>
    <% if @club.voting_deadline.present? %>
      <div class="bg-cream/30 rounded-lg p-4 mb-6 text-center"
           data-controller="countdown"
           data-countdown-deadline-value="<%= @club.voting_deadline.iso8601 %>"
           data-countdown-expired-text-value="<%= t('club_books.vote.voting_ended') %>">
        <% if @club.voting_deadline_passed? %>
          <p class="text-vermillion font-medium"><%= t("club_books.vote.voting_ended") %></p>
        <% else %>
          <p class="text-ink-muted text-sm"><%= t("club_books.vote.deadline") %></p>
          <p class="text-ink font-medium" data-countdown-target="display">...</p>
        <% end %>
      </div>
    <% end %>

    <% if @has_voted %>
      <div class="bg-sage/10 rounded-lg p-6 mb-8 flex items-center gap-4">
        <div class="w-10 h-10 rounded-full bg-sage/20 flex items-center justify-center flex-shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-sage" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
          </svg>
        </div>
        <div>
          <p class="text-ink font-medium"><%= t("club_books.vote.your_vote") %></p>
          <p class="text-ink-muted text-sm"><%= @user_vote.club_book.book.title %></p>
        </div>
      </div>
    <% end %>

    <div class="space-y-4">
      <% @voting_books.each do |club_book| %>
        <%= render "club_books/voting_card", club_book: club_book, has_voted: @has_voted, user_vote: @user_vote %>
      <% end %>
    </div>

    <% if @club.admin?(current_user) %>
      <div class="mt-8 pt-8 border-t border-cream text-center">
        <%= button_to t("club_books.vote.end_voting"),
            end_voting_club_club_books_path(@club),
            method: :post,
            form: { data: { turbo_confirm: t("club_books.vote.end_voting_confirm") } },
            class: "px-6 py-3 bg-vermillion text-white font-medium rounded-lg hover:bg-vermillion-dark transition-colors" %>
      </div>
    <% end %>
  <% end %>
</div>
